<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q&Aã‚µã‚¤ãƒˆ</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/@supabase/supabase-js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header>
        <div> <h1>ç§‹åŒ»ï¼çŸ¥æµè¢‹</h1>
        
        
       

        <!-- æ¤œç´¢æ©Ÿèƒ½ -->
    <input type="text" id="search-input" placeholder="è³ªå•ã‚’æ¤œç´¢">
    <button id="search-button">æ¤œç´¢</button>
        <button id="login">ãƒ­ã‚°ã‚¤ãƒ³</button>
        </div>
<div>
      <h5>ã€€çµŒé¨“ã®è¸è¥²ã€‚ã€€</h5>  
    <h5>ã‚ãªãŸã®å¤§å­¦ç”Ÿæ´»ã‚’ã€ã‚‚ã£ã¨ã‚¹ãƒãƒ¼ãƒˆã«ã€‚</h5>
    <p>â†ã¾ãšã¯æ¤œç´¢ã—ã¦ã¿ã‚ˆã†â€¼ï¸</p>
        
        </div>
        <nav>
<!--             <ul>
                <li>ã‚«ãƒ†ã‚´ãƒª1</li>
                <li>ã‚«ãƒ†ã‚´ãƒª2</li>
                <li>ã‚«ãƒ†ã‚´ãƒª3</li>
            </ul> -->
        </nav>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main>
        <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
        <aside>
            <section class="popular-questions">
                <h3>äººæ°—ã®è³ªå•</h3>
                <ul id="popular-questions-list">
                    <li>è³ªå•1</li>
                    <li>è³ªå•2</li>
                    <li>è³ªå•3</li>
                </ul>
            </section>

            <section class="notifications">
                <h3>é€šçŸ¥</h3>
                <ul id="notifications-list">
                    <li>æ–°ã—ã„å›ç­”ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ</li>
                    <li>è©•ä¾¡ã•ã‚Œã¾ã—ãŸ</li>
                </ul>
            </section>

            <section class="bookmarked-questions">
                <h3>ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã—ãŸè³ªå•</h3>
                <ul id="bookmarked-list">
                    <li>è³ªå•A</li>
                    <li>è³ªå•B</li>
                </ul>
            </section>
        </aside>

        <!-- è³ªå•ãƒªã‚¹ãƒˆ -->
        <section class="question-list">
            <div class="filters">
                <label><input type="radio" name="filter" value="newest"> æœ€æ–°</label>
                <label><input type="radio" name="filter" value="popular"> äººæ°—é †</label>
                <label><input type="radio" name="filter" value="unanswered"> æœªå›ç­”</label>
            </div>

            <div class="question">
                <h3>è³ªå•ã‚¿ã‚¤ãƒˆãƒ«</h3>
                 <!-- è³ªå•ãƒªã‚¹ãƒˆ -->
    <ul id="question-list"></ul>

    <!-- è³ªå•è©³ç´°ã¨å›ç­”æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div id="question-detail" style="display: none;">
        <h2 id="question-title-detail"></h2>
        <p id="question-detail-detail"></p>
        <button id="like-button">ğŸ‘ ã„ã„ã­ (<span id="like-count">0</span>)</button>
        
        <h3>å›ç­”ä¸€è¦§</h3>
        <ul id="answer-list"></ul>

        <h3>å›ç­”ã‚’æŠ•ç¨¿ã™ã‚‹</h3>
        <form id="answer-form">
            <textarea id="answer-content" placeholder="å›ç­”ã‚’å…¥åŠ›"></textarea><br>
            <button type="submit">å›ç­”ã‚’æŠ•ç¨¿</button>
        </form>
    </div>
                <p>è³ªå•ã®å†…å®¹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼...</p>
                <div class="tags">
                    <span class="tag">æ•°å­¦</span>
                    <span class="tag">ç‰©ç†</span>
                </div>
                <button class="bookmark-button">ğŸ“‘ ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯</button>
                <button class="edit-history-button">ç·¨é›†å±¥æ­´</button>
                <div class="edit-history" style="display:none;">
                    <p>2024-10-11: ç·¨é›†å±¥æ­´ã‚µãƒ³ãƒ—ãƒ«</p>
                </div>
            </div>

            <div class="answer">
                <p>å›ç­”ã®å†…å®¹...</p>
                <div class="rating">
                    <button class="upvote">ğŸ‘ å½¹ã«ç«‹ã£ãŸ</button>
                    <button class="downvote">ğŸ‘ å½¹ã«ç«‹ãŸãªã‹ã£ãŸ</button>
                </div>
                <button class="best-answer-button">ãƒ™ã‚¹ãƒˆã‚¢ãƒ³ã‚µãƒ¼ã«é¸ã¶</button>
                <div class="best-answer-badge" style="display:none;">ãƒ™ã‚¹ãƒˆã‚¢ãƒ³ã‚µãƒ¼</div>
            </div>

            <div class="poll">
                <h3>ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ: ã“ã®è³ªå•ã«æœ€é©ãªå›ç­”ã¯ï¼Ÿ</h3>
                <ul>
                    <li><label><input type="radio" name="poll" value="option1"> é¸æŠè‚¢1</label></li>
                    <li><label><input type="radio" name="poll" value="option2"> é¸æŠè‚¢2</label></li>
                </ul>
                <button class="vote-button">æŠ•ç¥¨</button>
            </div>
        </section>
    </main>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer>
        <p>ã‚µã‚¤ãƒˆãƒãƒªã‚·ãƒ¼</p>
        <p>åˆ©ç”¨è¦ç´„</p>
        <p>ãŠå•ã„åˆã‚ã›</p>
    </footer>

    <script>
        const supabaseUrl = 'https://vsqqkpymevezyxfyxris.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZzcXFrcHltZXZlenl4Znl4cmlzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjcxNzYwNjQsImV4cCI6MjA0Mjc1MjA2NH0.BXu8Na4VLvrcqqBebA8F8e8uogjyi2E_SLDsza1C884';
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

        $(document).ready(function () {
              // è³ªå•ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¦è¡¨ç¤º
            fetchQuestions();

            // è³ªå•ãƒªã‚¹ãƒˆã®å–å¾—ã¨è¡¨ç¤º
            async function fetchQuestions(query = '') {
                let { data: questions, error } = await supabaseClient
                    .from('questions')
                    .select('*')
                    .like('title', `%${query}%`);

                if (error) {
                    console.error("è³ªå•ã®å–å¾—ã‚¨ãƒ©ãƒ¼:", error);
                    return;
                }
                $('#question-list').empty();
                questions.forEach(question => {
                    $('#question-list').append(`
                        <li>
                            <a href="#" class="question-title" data-id="${question.id}">${question.title}</a>
                            <span>ğŸ‘ ${question.likes || 0}</span>
                        </li>
                    `);
                });
            }

            // æ¤œç´¢ãƒœã‚¿ãƒ³ã®å‡¦ç†
            $('#search-button').on('click', function() {
                const query = $('#search-input').val();
                fetchQuestions(query);
            });

            // æ–°ã—ã„è³ªå•ã®æŠ•ç¨¿å‡¦ç†
            $('#question-form').on('submit', async function(e) {

                e.preventDefault();
                const title = $('#question-title').val();
                const detail = $('#question-detail').val();
                const { data, error } = await supabaseClient.from('questions').insert([{ title, detail, likes: 0 }]);
                if (error) {
                    console.error("è³ªå•ã®æŠ•ç¨¿ã‚¨ãƒ©ãƒ¼:", error);
                    return;
                }
                $('#question-title').val('');
                $('#question-detail').val('');
                fetchQuestions();
            });

            // è³ªå•è©³ç´°ã‚’è¡¨ç¤º
            $('#question-list').on('click', '.question-title', async function(e) {

                // ä»–ã®ã¨ã“ã‹ã‚‰å…¥ã‚Œã¦ããŸ
        //          const response = await supabaseClient.from('questions').select('*');
        //     // console.log(response)
        //     const questions = response.data
        //     console.log("-----questions------")
        //     console.log(questions)


        //          const container = $('#questions-container');
        // // console.log("questions", questions)
        // container.empty();
        // questions.forEach(question => {
        //     container.append(`
        //         <div>
        //             <h3>${question.title}</h3>
        //             <p>${question.detail}</p>
        //             <button class="answer-btn" data-id="${question.id}">å›ç­”ã‚’è¦‹ã‚‹</button>
        //             <div class="answers" id="answers-${question.id}"></div>
        //         </div>
        //     `);
        // });

                e.preventDefault();
                const questionId = $(this).data('id');
                const { data: question, error } = await supabaseClient
                    .from('questions')ã€€ // ãƒ†ãƒ¼ãƒ–ãƒ«å
                    .select('*')ã€€ã€€ // å¿…è¦ãªåˆ—ã‚’é¸æŠ
                    .eq('id', questionId)ã€€    // æ¡ä»¶: idãŒä¸€è‡´ã™ã‚‹ã‚‚ã®
                    .single();ã€€ // å˜ä¸€ã®è¡Œã‚’å–å¾—

                if (error) {
                    console.error("è³ªå•è©³ç´°ã®å–å¾—ã‚¨ãƒ©ãƒ¼:", error);
                    return;
                }
                $('#question-title-detail').text(question.title);
                 $('#question-detail-detail').text(question.detail);
    
                $('#like-count').text(question.likes || 0);
                $('#question-detail').data('id', question.id).show();
                fetchAnswers(questionId);
            });

                        // å›ç­”ãƒªã‚¹ãƒˆã®å–å¾—ã¨è¡¨ç¤º
            async function fetchAnswers(questionId) {
                const { data: answers, error } = await supabaseClient
                    .from('answers')
                    .select('*')
                    .eq('question_id', questionId);

                if (error) {
                    console.error("å›ç­”ã®å–å¾—ã‚¨ãƒ©ãƒ¼:", error);
                    return;
                }
                $('#answer-list').empty();
                answers.forEach(answer => {
                    $('#answer-list').append(`<li>${answer.content}</li>`);
                });
                  $('#like-count').text(answers.likes || 0);
            }

            // å›ç­”ã®æŠ•ç¨¿å‡¦ç†
            $('#answer-form').on('submit', async function(e) {
                e.preventDefault();
                const answerContent = $('#answer-content').val();
                const questionId = $('#question-detail').data('id');
                const { data, error } = await supabaseClient
                    .from('answers')
                    .insert([{ content: answerContent, question_id: questionId }]);

                if (error) {
                    console.error("å›ç­”ã®æŠ•ç¨¿ã‚¨ãƒ©ãƒ¼:", error);
                    return;
                }
                $('#answer-content').val('');
                fetchAnswers(questionId);
            });

            // ã„ã„ã­æ©Ÿèƒ½ã®å‡¦ç†
            $('#like-button').on('click', async function() {
                const questionId = $('#question-detail').data('id');
                const { data: question, error } = await supabaseClient
                    .from('questions')
                    .select('likes')
                    .eq('id', questionId)
                    .single();

                if (error) {
                    console.error("ã„ã„ã­ã®å–å¾—ã‚¨ãƒ©ãƒ¼:", error);
                    return;
                }
                const newLikes = (question.likes || 0) + 1;

                const { error: updateError } = await supabaseClient
                    .from('questions')
                    .update({ likes: newLikes })
                    .eq('id', questionId);

                if (updateError) {
                    console.error("ã„ã„ã­ã®æ›´æ–°ã‚¨ãƒ©ãƒ¼:", updateError);
                    return;
                }
                $('#like-count').text(newLikes);
                fetchQuestions(); // ãƒªã‚¹ãƒˆã‚’æ›´æ–°ã—ã¦ã„ã„ã­æ•°ã‚’åæ˜ 
            });



            // è³ªå•ã®ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯æ©Ÿèƒ½
            $('.bookmark-button').on('click', function () {
                $(this).text('ğŸ“‘ ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯æ¸ˆã¿');
                // Supabaseã¸ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹å‡¦ç†ã‚’è¿½åŠ 
            });

            // ç·¨é›†å±¥æ­´ã®è¡¨ç¤º
            $('.edit-history-button').on('click', function () {
                $(this).next('.edit-history').toggle();
            });

            // å½¹ã«ç«‹ã£ãŸ/ç«‹ãŸãªã‹ã£ãŸãƒœã‚¿ãƒ³
            $('.upvote, .downvote').on('click', function () {
                // è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’Supabaseã¸é€ä¿¡ã™ã‚‹å‡¦ç†ã‚’è¿½åŠ 
            });

            // ãƒ™ã‚¹ãƒˆã‚¢ãƒ³ã‚µãƒ¼é¸æŠæ©Ÿèƒ½
            $('.best-answer-button').on('click', function () {
                $(this).siblings('.best-answer-badge').show();
                // Supabaseã¸ãƒ™ã‚¹ãƒˆã‚¢ãƒ³ã‚µãƒ¼æƒ…å ±ã‚’é€ä¿¡ã™ã‚‹å‡¦ç†ã‚’è¿½åŠ 
            });

            // æŠ•ç¥¨æ©Ÿèƒ½
            $('.vote-button').on('click', function () {
                const selectedOption = $('input[name="poll"]:checked').val();
                // é¸æŠã•ã‚ŒãŸæŠ•ç¥¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’Supabaseã«é€ä¿¡ã™ã‚‹å‡¦ç†ã‚’è¿½åŠ 
            });

            // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã®ä¾‹
            $('#login').on('click', function () {
                // Supabaseã®èªè¨¼APIã‚’ä½¿ã£ãŸãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã‚’ã“ã“ã«è¿½åŠ 
            });
        });

// ã‚¿ã‚°ã«ã‚ˆã‚‹è³ªå•ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
async function getQuestionsByTag(tagName) {
    let { data, error } = await supabase
        .from('questions')
        .select(`
            id,
            title,
            detail,
            tags!inner(name)
        `)
        .eq('tags.name', tagName);

    if (error) {
        console.error("Error fetching questions:", error);
    } else {
        console.log("Filtered questions by tag:", data);
    }
}



    </script>

</body>
</html>
